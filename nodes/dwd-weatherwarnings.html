<!-- ===== Edit-Dialog Template ===== -->
<script type="text/html" data-template-name="dwd-weatherwarnings">
    <div class="form-row">
        <label for="node-input-name">
            <i class="fa fa-tag"></i>
            <span data-i18n="label.name">Name</span>
        </label>
        <input type="text" id="node-input-name" placeholder="DWD Warnings">
    </div>

    <div class="form-row">
        <label for="node-input-warncells">
            <i class="fa fa-filter"></i>
            <span data-i18n="label.warncells">Warncell-ID</span>
        </label>
        <input type="text"
               id="node-input-warncells"
               data-i18n="[placeholder]ui.warncellsPlaceholder"
               placeholder="z. B. 105315000">
        <div class="form-tips">
            <span data-i18n="ui.warncellsTip">
                Filter auf eine spezifische WARNCELLID. Leer lassen = alle Meldungen.
            </span>
            <a href="https://www.dwd.de/DE/leistungen/opendata/help/warnungen/cap_warncellids_csv.html"
               target="_blank"
               data-i18n="ui.warncellsLinkText">
                Liste der DWD Warncell-IDs anzeigen
            </a>
        </div>
    </div>

    <hr/>

    <div class="form-row">
        <label for="node-input-areaNameMatch">
            <i class="fa fa-map-marker"></i>
            <span data-i18n="label.areaNameMatch">Name-Fallback</span>
        </label>
        <input type="checkbox" id="node-input-areaNameMatch" style="width:auto;">
        <span style="margin-left:6px;"
              data-i18n="ui.areaNameMatchLabel">
            Gebiets-Namensabgleich erlauben (areaDesc)
        </span>
        <div class="form-tips"
             data-i18n="ui.areaNameMatchTip">
            Wenn aktiv und unten Namen angegeben sind, werden Warnungen zusätzlich behalten, wenn
            <code>areaDesc</code> einen der Namen enthält (Groß/Kleinschreibung egal).
        </div>
    </div>

    <div class="form-row">
        <label for="node-input-extraAreaNames">
            <i class="fa fa-list"></i>
            <span data-i18n="label.extraAreaNames">
                Zusätzliche Gebietsnamen
            </span>
        </label>
        <input type="text"
               id="node-input-extraAreaNames"
               data-i18n="[placeholder]ui.extraAreaNamesPlaceholder"
               placeholder="z. B. Köln, Düsseldorf, Bedburg">
        <div class="form-tips"
             data-i18n="ui.extraAreaNamesTip">
            Kommagetrennt. Beim Filtern wird Warncell-Match ODER Gebietsname in areaDesc verwendet.
        </div>
    </div>

    <hr/>

    <div class="form-row">
        <label for="node-input-activeOnly">
            <i class="fa fa-clock-o"></i>
            <span data-i18n="label.activeOnly">
                Nur aktive &amp; zukünftige
            </span>
        </label>
        <input type="checkbox" id="node-input-activeOnly" style="width:auto;">
        <span style="margin-left:6px;"
              data-i18n="ui.activeOnlyLabel">
            Nur aktive &amp; zukünftige Warnungen
        </span>
        <div class="form-tips"
             data-i18n="ui.activeOnlyTip">
            Wenn aktiv, enthält die Ausgabe nur Meldungen, die aktuell laufen oder in der Zukunft liegen.
        </div>
    </div>

    <div class="form-row">
        <label for="node-input-staleAllow">
            <i class="fa fa-hourglass-half"></i>
            <span data-i18n="label.staleAllow">
                Stale erlauben
            </span>
        </label>
        <input type="checkbox" id="node-input-staleAllow" style="width:auto;">
        <span style="margin-left:6px;"
              data-i18n="ui.staleAllowLabel">
            Bei XML-/HTTP-Fehlern letzten erfolgreichen Stand liefern
        </span>
        <div class="form-tips"
             data-i18n="ui.staleAllowTip">
            Erlaube Fallback auf die neueste Datei aus dem Verzeichnis, wenn <code>_LATEST_</code> 404 liefert.
            Ist diese Option <b>aus</b>, bricht der Node in diesem Fall mit Fehler ab.
        </div>
    </div>

    <div class="form-row">
        <label for="node-input-autoRefresh">
            <i class="fa fa-refresh"></i>
            <span data-i18n="label.autoRefresh">
                Auto-Refresh (Sek.)
            </span>
        </label>
        <input type="number"
               id="node-input-autoRefresh"
               min="0"
               step="1"
               placeholder="0 = aus">
        <div class="form-tips"
             data-i18n="ui.autoRefreshTip">
            Intervall für automatische Abrufe in Sekunden. 0 = deaktiviert.
        </div>
    </div>

    <div class="form-row">
        <label for="node-input-fetchOnDeploy">
            <i class="fa fa-bolt"></i>
            <span data-i18n="label.fetchOnDeploy">
                Beim Deploy abrufen
            </span>
        </label>
        <input type="checkbox" id="node-input-fetchOnDeploy" style="width:auto;">
        <span style="margin-left:6px;"
              data-i18n="ui.fetchOnDeployTip">
            Direkten Datenabruf bei Deploy aktivieren
        </span>
    </div>

    <div class="form-row">
        <label for="node-input-diag">
            <i class="fa fa-bug"></i>
            <span data-i18n="label.diag">
                Diagnose-Logs
            </span>
        </label>
        <input type="checkbox" id="node-input-diag" style="width:auto;">
        <span style="margin-left:6px;"
              data-i18n="ui.diagTip">
            Zusätzliche Protokollierung im Node-RED-Log aktivieren.
        </span>
    </div>
</script>

<!-- ===== Registrierung ===== -->
<script type="text/javascript">
    (function () {
        RED.nodes.registerType("dwd-weatherwarnings", {
            category: "input",
            color: "#d7e6ff",
            icon: "font-awesome/fa-exclamation-triangle",

            paletteLabel: function () {
                return RED._("node-red-contrib-dwd-weatherwarnings/dwd-weatherwarnings:paletteLabel")
                    || "DWD Weather Warnings";
            },

            defaults: {
                name:           { value: "" },
                warncells:      { value: "" },

                areaNameMatch:  { value: false },
                extraAreaNames: { value: "" },

                activeOnly:   { value: true },
                staleAllow:   { value: true },

                // Legacy-Feld beibehalten (Kompatibilität)
                nameFallback: { value: true },

                autoRefresh:   { value: 0 },
                fetchOnDeploy: { value: true },
                diag:          { value: false }
            },

            inputs: 1,
            outputs: 1,

            label: function () {
                return this.name || this._("label.defaultName");
            },

            labelStyle: function () {
                return this.name ? "node_label_italic" : "";
            },

            oneditprepare: function () {
                $("#node-input-autoRefresh").attr({ min: 0, step: 1 });
            }
        });
    })();
</script>

<style>
    .form-row label {
        width: 200px;
        display: inline-block;
        vertical-align: top;
    }

    .form-row input[type="text"],
    .form-row input[type="number"],
    .form-row select {
        width: calc(100% - 210px);
    }

    .form-tips {
        font-size: 0.85em;
        color: #666;
        margin-left: 200px;
        line-height: 1.4em;
    }

    .form-tips code {
        font-family: monospace;
        word-break: break-all;
    }
</style>