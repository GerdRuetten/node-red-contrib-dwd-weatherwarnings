<script type="text/html" data-template-name="dwd-weatherwarnings">
  <div class="form-row">
    <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
    <input type="text" id="node-input-name" placeholder="DWD Warnings">
  </div>

  <div class="form-row">
    <label for="node-input-dataset"><i class="fa fa-database"></i> Dataset</label>
    <select id="node-input-dataset">
      <option value="COMMUNEUNION_CELLS_STAT">COMMUNEUNION_CELLS_STAT (feiner, empfohlen)</option>
      <option value="DISTRICT_CELLS_STAT">DISTRICT_CELLS_STAT (gröber)</option>
    </select>
    <div class="form-tips">
      Auflösung wählen: <b>COMMUNEUNION</b> (Gemeindeverband, fein) oder
      <b>DISTRICT</b> (Landkreis, gröber).
    </div>
  </div>

  <div class="form-row">
    <label for="node-input-warncells"><i class="fa fa-filter"></i> Warncell-ID(s)</label>
    <input type="text" id="node-input-warncells" placeholder="z. B. 053620000, 053620004">
    <div class="form-tips">
      Filter auf spezifische <b>WARNCELLID</b>. Mehrere IDs mit Komma oder Leerzeichen trennen.
      Leer lassen = alle Meldungen. <a href="https://www.dwd.de/DE/leistungen/opendata/help/warnungen/cap_warncellids_csv.html" target="_blank">
      Liste der DWD Warncell-IDs anzeigen
    </a>
    </div>
  </div>

  <hr/>

  <div class="form-row">
    <label for="node-input-areaNameMatch"><i class="fa fa-map-marker"></i> Name-Fallback</label>
    <input type="checkbox" id="node-input-areaNameMatch" style="width:auto;">
    <span style="margin-left:6px;">Gebiets-Namensabgleich erlauben (areaDesc)</span>
    <div class="form-tips">
      Wenn aktiv und unten Namen angegeben sind, werden Warnungen zusätzlich behalten, wenn
      <code>areaDesc</code> einen der Namen enthält (Groß/Kleinschreibung egal).
    </div>
  </div>

  <div class="form-row">
    <label for="node-input-extraAreaNames"><i class="fa fa-list"></i> Zusätzliche Gebiets­namen</label>
    <input type="text" id="node-input-extraAreaNames" placeholder="z. B. Bedburg, Königshoven, Kaster">
    <div class="form-tips">
      Kommagetrennt. Beim Filtern wird <b>Warncell-Match ODER Gebietsname in areaDesc</b> verwendet.
    </div>
  </div>

  <hr/>

  <div class="form-row">
    <label for="node-input-activeOnly"><i class="fa fa-clock-o"></i> Nur aktive & zukünftige</label>
    <input type="checkbox" id="node-input-activeOnly" style="width:auto;">
    <span style="margin-left:6px;">Abgelaufene Meldungen (past=true) ausfiltern</span>
    <div class="form-tips">
      Wenn aktiv, enthält die Ausgabe nur Meldungen, die aktuell laufen oder in der Zukunft liegen.
    </div>
  </div>

  <div class="form-row">
    <label for="node-input-staleAllow"><i class="fa fa-hourglass-half"></i> Stale erlauben</label>
    <input type="checkbox" id="node-input-staleAllow" style="width:auto;">
    <span style="margin-left:6px;">Bei XML-/HTTP-Fehlern letzten erfolgreichen Stand liefern</span>
    <div class="form-tips">
      Erlaube Fallback auf die neueste Datei aus dem Verzeichnis, wenn <code>_LATEST_</code> 404 liefert.
      Ist diese Option <b>aus</b>, bricht der Node in diesem Fall mit Fehler ab.
    </div>
  </div>

  <div class="form-row">
    <label for="node-input-autoRefresh"><i class="fa fa-refresh"></i> Auto-Refresh (Sek.)</label>
    <input type="number" id="node-input-autoRefresh" min="0" step="1" placeholder="0 = aus">
    <div class="form-tips">Intervall für automatische Abrufe in Sekunden. 0 = deaktiviert.</div>
  </div>

  <div class="form-row">
    <label for="node-input-fetchOnDeploy"><i class="fa fa-bolt"></i> Beim Deploy abrufen</label>
    <input type="checkbox" id="node-input-fetchOnDeploy" style="width:auto;">
    <span style="margin-left:6px;">Direkter Datenabruf bei Deploy aktivieren</span>
  </div>

  <div class="form-row">
    <label for="node-input-diag"><i class="fa fa-bug"></i> Diagnose-Logs</label>
    <input type="checkbox" id="node-input-diag" style="width:auto;">
    <span style="margin-left:6px;">Protokollierung aktivieren</span>
  </div>
</script>

<script type="text/javascript">
  RED.nodes.registerType("dwd-weatherwarnings", {
    category: "input",
    color: "#d7e6ff",
    paletteLabel: "DWD Warnings",
    defaults: {
      name: { value: "" },
      dataset: { value: "COMMUNEUNION_CELLS_STAT" },
      warncells: { value: "" },

      // NEU:
      areaNameMatch: { value: false },
      extraAreaNames: { value: "" },

      activeOnly: { value: true },
      staleAllow: { value: true },
      nameFallback: { value: true }, // belassen, falls ihr’s weiterhin nutzen wollt

      autoRefresh: { value: 0 },
      fetchOnDeploy: { value: true },
      diag: { value: false }
    },
    inputs: 1,
    outputs: 1,
    icon: "font-awesome/fa-exclamation-triangle",
    label: function () {
      return this.name || "DWD Warnings";
    }
  });
</script>